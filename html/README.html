

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>trace_airmass_source: trajectory analysis tool &mdash; trace_airmass_source 0.4 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Setup" href="setup.html" />
    <link rel="prev" title="trace documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> trace_airmass_source
          

          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#local-python-installataion">local python installataion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#docker-container">docker container</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quick-setup">Quick-Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-the-transport-simulations">Preparing the transport simulations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hysplit">HYSPLIT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flexpart">FLEXPART</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-airmass-source-estimate">Running the airmass source estimate</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#surface-classification">Surface classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modis-land-cover">MODIS land cover</a></li>
<li class="toctree-l3"><a class="reference internal" href="#named-geography">“named geography”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#config-files">config files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#used-in">Used in</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_overview.html">api documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">trace_airmass_source</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>trace_airmass_source: trajectory analysis tool</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="trace-airmass-source-trajectory-analysis-tool">
<h1>trace_airmass_source: trajectory analysis tool<a class="headerlink" href="#trace-airmass-source-trajectory-analysis-tool" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://doi.org/10.5281/zenodo.2576558"><img alt="DOI" src="https://zenodo.org/badge/DOI/10.5281/zenodo.2576558.svg" /></a></p>
<p>Airmass transport simulations are combined with a land cover classification for a temporally and vertically resolved airmass source attribution.
The air parcel locations can be taken form HYSPLIT ensemble trajectories (Stein et al., 2015) or particle positions from FLEXPART (PISSO et al., 2019).</p>
<p>Whenever a airparcel is below a defined reception height, the land cover is categorized using custom defined polygons encompassing areas of interest or a simplified version (number of categories reduced to 7) of the MODIS land cover classification (Friedl et al., 2002, Broxton et al., 2014).
An airparcel is assumed to be influenced by the land surface if the trajectory is below the reception. The residence time for each category is then the total time an airparcel fulfilled this criterion by land cover category. This calculation is repeated in steps of 3h in time and 500m in height to provide a continuous estimate on the airmass source and as a first hint on potential aerosol load.
From the results a time-height plot of airmass source can be generated for a certain location, which is comparable to active remote sensing time-height plots.</p>
<p>Comprehensive documentation is available at <a class="reference external" href="https://martin-rdz.github.io/trace-doc/">trace-doc</a> and in <a class="reference external" href="https://acp.copernicus.org/preprints/acp-2020-955/">ACP Discussion paper</a></p>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p><img alt="_images/map_to_profile_pub_small.png" src="_images/map_to_profile_pub_small.png" />
<img alt="_images/20170914_limassol_flexpart_small.png" src="_images/20170914_limassol_flexpart_small.png" /></p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>trace_airmass_source is written in python3 and requires an extensive of additional packages. There are two options to acquire these packages.</p>
<div class="section" id="local-python-installataion">
<h3>local python installataion<a class="headerlink" href="#local-python-installataion" title="Permalink to this headline">¶</a></h3>
<p>Install all the packages listed in <a class="reference external" href="requirements.txt">requirements.txt</a></p>
</div>
<div class="section" id="docker-container">
<h3>docker container<a class="headerlink" href="#docker-container" title="Permalink to this headline">¶</a></h3>
<p>Deployment may be simplified using a docker image which includes all the dependencies.
This docker container also includes Flexpart 10.4.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># build the Dockerfile
docker build -t trace_env .
# run an interactive bash on this image
docker run -v `pwd`:/trace -it trace_env /bin/bash
# or to build the documentation as well
docker run -v `pwd`/..:/trace -it trace_env /bin/bash
# or to just run a command
docker exec -i CONTAINERNAME bash -c &quot;cd trace &amp;&amp; ...&quot;
</pre></div>
</div>
<p>When using docker under windows, the <code class="docutils literal notranslate"><span class="pre">pwd</span></code> has to be replaced by the path to the local trace directory.</p>
</div>
</div>
<div class="section" id="quick-setup">
<h2>Quick-Setup<a class="headerlink" href="#quick-setup" title="Permalink to this headline">¶</a></h2>
<p>Please put your credentials (name, institution, contact) in the <code class="docutils literal notranslate"><span class="pre">output_meta.toml</span></code> file.</p>
<p>If FLEXPART shall be used with GFS grib data, the login credential for the GFS data from <code class="docutils literal notranslate"><span class="pre">rda.ucar.edu</span></code> has to be stored in <code class="docutils literal notranslate"><span class="pre">server_logins.toml</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">flexpart</span><span class="p">]</span>
    <span class="n">login</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>Each station requires a config file. An example for Limassol is provided <code class="docutils literal notranslate"><span class="pre">config_limassol.toml</span></code>.
A subfolder named after the respective station should exisit the folders <code class="docutils literal notranslate"><span class="pre">trajectories</span></code>, <code class="docutils literal notranslate"><span class="pre">flexpart_partposit</span></code> and <code class="docutils literal notranslate"><span class="pre">output</span></code>.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Running trace consists of several steps, that are (partly) automated in the <code class="docutils literal notranslate"><span class="pre">autorun.sh</span></code> script.</p>
<div class="section" id="preparing-the-transport-simulations">
<h3>Preparing the transport simulations<a class="headerlink" href="#preparing-the-transport-simulations" title="Permalink to this headline">¶</a></h3>
<p>As input for an airmass source estimate, either HYSPLIT backward trajectories <strong>or</strong> FLEXPART particle positions are required.
Simulations with FLEXPART can be done within the docker container. The HYSPLIT backward trajectories have to be calculated separately.</p>
<div class="section" id="hysplit">
<h4>HYSPLIT<a class="headerlink" href="#hysplit" title="Permalink to this headline">¶</a></h4>
<p>HYSPLIT backward trajectories are required, a 10-day 27-member ensemble setup is recommended. Please note that HYSPLIT itself is not provided within this package (The binary to run is <code class="docutils literal notranslate"><span class="pre">hyts_ens</span></code> with the respective <code class="docutils literal notranslate"><span class="pre">CONTROL</span></code> file).
Meteorological input data for HYSPLIT are taken from the GDAS1 dataset (<a class="reference external" href="https://www.ready.noaa.gov/gdas1.php">https://www.ready.noaa.gov/gdas1.php</a>) provided by the Air Resources Laboratory (ARL) of the U.S. National Weather Service’s National Centers for Environmental Prediction (NCEP).
An trajectory is calculated every 3h in steps of 500m. Conveniently the input trajectories are placed in the <code class="docutils literal notranslate"><span class="pre">trajectories</span></code> directory.</p>
<p>A list of required trajectories can be generated with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">gen_hysplit_input</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">station</span> <span class="n">STATIONNAME</span>
</pre></div>
</div>
<p>The filename of each trajectory should be</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hysplit_trajectory</span><span class="o">-</span><span class="p">[</span><span class="n">YYYYMMDD</span><span class="o">-</span><span class="n">HH</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="n">lat</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="n">lon</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="n">height</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="n">length</span><span class="p">]</span><span class="o">.</span><span class="n">tdump</span>
</pre></div>
</div>
<p>See the documenation for more information on configuring the HYSPLIT simulations.
After the HYSPLIT output is on hand, it can be checked if all required files are available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">test_data_avail</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">station</span> <span class="p">[</span><span class="n">stationname</span><span class="p">]</span> <span class="o">--</span><span class="n">daterange</span> <span class="p">[</span><span class="n">YYYYMMDD_begin</span><span class="o">-</span><span class="n">YYYYMMDD_end</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="flexpart">
<h4>FLEXPART<a class="headerlink" href="#flexpart" title="Permalink to this headline">¶</a></h4>
<p>Download the GFS grib files (using the credentials defined in <code class="docutils literal notranslate"><span class="pre">server_logins.toml</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">download_gfs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">daterange</span> <span class="n">YYYYMMDD</span><span class="o">-</span><span class="n">YYYYMMDD</span>
</pre></div>
</div>
<p>Start the FLEXPART run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">run_flexpart_trace</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">station</span> <span class="n">STATIONNAME</span> <span class="o">--</span><span class="n">date</span> <span class="n">YYYYMMDD</span>
</pre></div>
</div>
<p>Optionally, plot and animate the particle positions</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">animate_flex</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">station</span> <span class="n">STATIONNAME</span> <span class="o">--</span><span class="n">datetime</span> <span class="n">YYYYMMDD</span><span class="o">-</span><span class="n">HH</span> <span class="o">--</span><span class="n">levels</span> <span class="n">I</span><span class="p">,</span><span class="n">J</span> <span class="o">--</span><span class="n">dynamics</span> <span class="n">true</span><span class="o">|</span><span class="n">false</span>    
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-the-airmass-source-estimate">
<h3>Running the airmass source estimate<a class="headerlink" href="#running-the-airmass-source-estimate" title="Permalink to this headline">¶</a></h3>
<p>The actual processing is started with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python3 run_assemble.py --model FLEX¦HYSPLIT --station STATIONNAME --daterange YYYYMMDD-YYYYMMDD
</pre></div>
</div>
<p>From the netcdf files in the <code class="docutils literal notranslate"><span class="pre">output</span></code> directory the plots are generated by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">plot2d</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">model</span> <span class="n">FLEX</span><span class="o">|</span><span class="n">HYSPLIT</span>  <span class="o">--</span><span class="n">station</span> <span class="n">STATIONNAME</span> <span class="o">--</span><span class="n">daterange</span> <span class="n">YYYYMMDD</span><span class="o">-</span><span class="n">YYYYMMDD</span>
</pre></div>
</div>
<p>Afterwards the files with the raw trajectires (currently only HYSPLIT) can be compressed to day-wise zip files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">compress_data</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">station</span> <span class="n">STATIONNAME</span> <span class="o">--</span><span class="n">daterange</span> <span class="n">YYYYMMDD</span><span class="o">-</span><span class="n">YYYYMMDD</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="surface-classification">
<h2>Surface classification<a class="headerlink" href="#surface-classification" title="Permalink to this headline">¶</a></h2>
<p>Currently two sources for the surface classification are available. The raster-based MODIS land cover classification and the polygon-based geography names.</p>
<p><img alt="_images/maps_combined_doc.png" src="_images/maps_combined_doc.png" /></p>
<div class="section" id="modis-land-cover">
<h3>MODIS land cover<a class="headerlink" href="#modis-land-cover" title="Permalink to this headline">¶</a></h3>
<p>The MODIS land cover classification (Friedl et al., 2002, Broxton et al., 2014) with its 17 categories and 0.5km resolution is simplified to 7 categories (barren, snow, urban, grass, savanna/shrublands, forrest, water) and regridded to a 0.1º (~11km).</p>
</div>
<div class="section" id="named-geography">
<h3>“named geography”<a class="headerlink" href="#named-geography" title="Permalink to this headline">¶</a></h3>
<p>The extend and the name of a geography feature - usually a (sub-)continent - is defend within a <code class="docutils literal notranslate"><span class="pre">.kml</span></code> file. Examples for are available in the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory for Europe and the shorelines of the Atlantic Ocean.</p>
</div>
</div>
<div class="section" id="config-files">
<h2>config files<a class="headerlink" href="#config-files" title="Permalink to this headline">¶</a></h2>
<p>Trace can by adjusted by two types of config files. One for the site or campaign named <code class="docutils literal notranslate"><span class="pre">config_[site_name].toml</span></code>. Examples are given for the site of Limassol and the Polarstern cruise PS113.
The second one - <code class="docutils literal notranslate"><span class="pre">geonames_config.toml</span></code> - is used to wire togehter the named geographies.</p>
</div>
<div class="section" id="used-in">
<h2>Used in<a class="headerlink" href="#used-in" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Haarig, M., Ansmann, A., Gasteiger, J., Kandler, K., Althausen, D., Baars, H., Radenz, M., and Farrell, D. A.: Dry versus wet marine particle optical properties: RH dependence of depolarization ratio, backscatter, and extinction from multiwavelength lidar measurements during SALTRACE, Atmos. Chem. Phys., 17, 14199-14217, <a class="reference external" href="https://doi.org/10.5194/acp-17-14199-2017">https://doi.org/10.5194/acp-17-14199-2017</a>, 2017.</p></li>
<li><p>Foth, A., Kanitz, T., Engelmann, R., Baars, H., Radenz, M., Seifert, P., Barja, B., Fromm, M., Kalesse, H., and Ansmann, A.: Vertical aerosol distribution in the southern hemispheric midlatitudes as observed with lidar in Punta Arenas, Chile (53.2° S and 70.9° W), during ALPACA, Atmos. Chem. Phys., 19, 6217–6233, <a class="reference external" href="https://doi.org/10.5194/acp-19-6217-2019">https://doi.org/10.5194/acp-19-6217-2019</a>, 2019.</p></li>
</ul>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Stein, A.F., R.R. Draxler, G.D. Rolph, B.J. Stunder, M.D. Cohen, and F. Ngan: NOAA’s HYSPLIT Atmospheric Transport and Dispersion Modeling System. Bull. Amer. Meteor. Soc., 96, 2059–2077, <a class="reference external" href="https://doi.org/10.1175/BAMS-D-14-00110.1">https://doi.org/10.1175/BAMS-D-14-00110.1</a>, 2015</p></li>
<li><p>Friedl, M. A., McIver, D. K., Hodges, J. C., Zhang, X. Y., Muchoney, D., Strahler, A. H., Woodcock, C.E., Gopal, S., Schneider, A., Cooper, A., Baccini, A., Gao, F., Schaaf, C.: Global land cover mapping from MODIS: algorithms and early results. Remote Sens. Environ., 83(1-2), 287-302, <a class="reference external" href="https://doi.org/10.1016/S0034-4257(02)00078-0">https://doi.org/10.1016/S0034-4257(02)00078-0</a>, 2002</p></li>
<li><p>Broxton, P.D., Zeng, X., Sulla-Menashe, D., Troch, P.A.: A Global Land Cover Climatology Using MODIS Data. J. Appl. Meteor. Climatol., 53, 1593-1605. <a class="reference external" href="http://dx.doi.org/10.1175/JAMC-D-13-0270.1">http://dx.doi.org/10.1175/JAMC-D-13-0270.1</a>, 2014</p></li>
<li><p>Radenz, M., Seifert, P., Baars, H., Floutsi, A. A., Yin, Z., and Bühl, J.: Automated time-height-resolved airmass source attribution for profiling remote sensing applications, Atmos. Chem. Phys. Discuss. [preprint], <a class="reference external" href="https://doi.org/10.5194/acp-2020-955">https://doi.org/10.5194/acp-2020-955</a>, in review, 2020.</p></li>
</ul>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>See the LICENSE file for more information
Copyright 2020, Martin Radenz
<a class="reference external" href="http://www.opensource.org/licenses/mit-license.php">MIT License</a></p>
<!--
https://landcover.usgs.gov/global_climatology.php 
http://journals.ametsoc.org/doi/abs/10.1175/JAMC-D-13-0270.1--></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="setup.html" class="btn btn-neutral float-right" title="Setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="trace documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Martin Radenz

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>